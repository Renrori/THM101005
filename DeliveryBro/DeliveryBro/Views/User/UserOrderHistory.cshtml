@{
    ViewData["HideFooter"] = true;
}

<aside b-y5hjwqsk06 id="sidebar" class="sidebar">

    <ul b-y5hjwqsk06 class="sidebar-nav" id="sidebar-nav">

        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link" href="#"><i b-y5hjwqsk06 class="bi bi-grid"></i>Home</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserHome"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>我的資料</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserOrder"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>我的訂單</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserOrderHistory"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>歷史訂單</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" href="#"><i b-y5hjwqsk06 class="fa-solid fa-circle-info"></i>Support</a>
        </li>
    </ul>

</aside><!-- End Sidebar-->

<div b-y5hjwqsk06>
    <div class="container">
        <div class="row justify-content-end">
            <div class="col-xl-9">
                <div class="pagetitle">
                    <h1>歷史訂單</h1>
                </div>
                <div id="app">
                    <section class="section neworders">
                        <div class="row">
                            <div class="col">
                                <div class="card">
                                    <div class="card-body pt-3">
                                        <!-- Bordered Tabs -->
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-4 ">
                                                    <label>訂單編號&emsp;</label>
                                                    <div class="row align-items-center">
                                                        <div class="col-8">
                                                            <input type="text" class="--bs-dark-border-subtle --bs-dark-text-emphasis form-control" placeholder="目前無法使用" v-model="searchorderId" />
                                                        </div>
                                                        <div class="col-4">
                                                            <button class="btn btn-primary" @@click="searchOrder(searchorderId)">搜尋</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                @*                                                <div class="col-3 ">
                                                <label style="text-align:right">訂單完成日期&emsp;</label>
                                                <input type="date" v-model="" />
                                                </div>
                                                <div class="col-2 ">
                                                <input type="date" v-model="" />
                                                </div>*@
                                            </div>
                                        </div>
                                        <div class="tab-content pt-2" v-if="searchResult">
                                            <div class="card" v-for="item in CustomerOrderInfo" :key="orderId">
                                                <div class="card-body">
                                                    <h5 class="card-title">訂單編號: {{ item.orderId }} </h5>
                                                    <h5>完成時間: {{item.orderDate}}</h5>
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row" v-for="detail in item.orderDetails">
                                                                <div class="col-lg-3 col-md-4 label">{{detail.dishName}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.unitPrice}}</div>
                                                                <div class="col-lg-2 col-md-2">{{detail.quantity}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.subtotal}}</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>Total: ${{item.total}}</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div>
                                                        <h5>備註: </h5>
                                                        <div>{{ item.note }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-content pt-2" v-else>
                                            <div class="card" v-for="item in CustomerOrderInfo" :key="orderId">
                                                <div class="card-body">
                                                    <h5 class="card-title">訂單編號: {{ item.orderId }} </h5>
                                                    <h5>完成時間: {{item.orderDate}}</h5>
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row" v-for="detail in item.orderDetails">
                                                                <div class="col-lg-3 col-md-4 label">{{detail.dishName}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.unitPrice}}</div>
                                                                <div class="col-lg-2 col-md-2">{{detail.quantity}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.subtotal}}</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>Total: ${{item.total}}</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div>
                                                        <h5>備註: </h5>
                                                        <div>{{ item.note }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue@3.2.36/dist/vue.global.prod.js"></script>
    <script src="~/axios/axios.min.js"></script>
    <script>
        var baseAddress = "https://localhost:7163/api/UserApi";
        var CustomerId = "@User.Claims.FirstOrDefault(c => c.Type == "CustomerId")?.Value";
        var vueApp = {
            data() {
                return {
                    CustomerOrderInfo: [],
                    searchResult: null,
                    searchorderId: ""
                }
            },
            mounted() {
                this.getUserOrder();
            },
            methods: {
                async getUserOrder() {
                    //拿出對應cusId的order
                    try {
                        const response = await axios.get(`${baseAddress}/${CustomerId}/orderdetails`).then(Response => {
                            this.CustomerOrderInfo = Response.data;
                        })
                    } catch (error) {
                        console.error(error);
                    }
                },
                searchOrder(searchorderId) {
                    const foundOrder = this.CustomerOrderInfo.find(order => order.orderId === searchorderId)
                    if (foundOrder) {
                        this.searchResult = foundOrder;
                        console.log("match")
                    }
                    else {
                        this.searchResult = null;
                        console.log("notmatch")
                    }
                }
            }
        };
        var app = Vue.createApp(vueApp).mount("#app");
    </script>
    }
