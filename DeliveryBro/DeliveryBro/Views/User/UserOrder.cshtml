@{
    ViewData["HideFooter"] = true;
}

@section Styles
    {
    <style>
        .custom-pagination .page-link {
            color: forestgreen;
            border-color: forestgreen;
        }

        .custom-pagination .page-item.active .page-link {
            background-color: forestgreen;
            border-color: forestgreen;
            color: white;
        }

    </style>
}


<aside b-y5hjwqsk06 id="sidebar" class="sidebar">

    <ul b-y5hjwqsk06 class="sidebar-nav" id="sidebar-nav">

        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link" asp-controller="User" asp-action="UserHome"><i b-y5hjwqsk06 class="bi bi-grid"></i>Home</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserHome"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>我的資料</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserAddress"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>我的地址</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserOrder"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>我的訂單</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" asp-controller="User" asp-action="UserOrderHistory"><i b-y5hjwqsk06 class="fa-solid fa-store"></i>歷史訂單</a>
        </li>
        <li b-y5hjwqsk06 class="nav-item">
            <a class="nav-link collapsed" href="#"><i b-y5hjwqsk06 class="fa-solid fa-circle-info"></i>Support</a>
        </li>
    </ul>

</aside><!-- End Sidebar-->

<div b-y5hjwqsk06>
    <div class="container">
        <div class="row justify-content-end">
            <div class="col-xl-9">
                <div class="pagetitle">
                    <h1>我的訂單</h1>
                </div>
                <div id="app">
                    <section class="section neworders">
                        <div class="row">
                            <div class="col">
                                <div class="card">
                                    <div class="card-body pt-3">
                                        <!-- Bordered Tabs -->
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-4 ">
                                                    <label>訂單編號&emsp;</label>
                                                    <div class="row align-items-center">
                                                        <div class="col-8">
                                                            <input type="text" class="--bs-dark-border-subtle --bs-dark-text-emphasis form-control" placeholder="目前無法使用" v-model="searchorderId" />
                                                        </div>
                                                        <div class="col-4">
                                                            <button class="btn btn-primary" @@click="searchOrder(searchorderId)">搜尋</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                @*                                                <div class="col-3 ">
                                                <label style="text-align:right">訂單完成日期&emsp;</label>
                                                <input type="date" v-model="" />
                                                </div>
                                                <div class="col-2 ">
                                                <input type="date" v-model="" />
                                                </div>*@
                                            </div>
                                        </div>
                                        <div class="tab-content pt-2" v-if="searchResult">
                                            <div class="card" v-for="item in currentPageOrders" :key="item.orderId">
                                                <div class="card-body">
                                                    <h5 class="card-title">訂單編號: {{ item.orderId }} </h5>
                                                    <h5>完成時間: {{item.orderDate}}</h5>
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row">
                                                                <div class="col-lg-3 col-md-4 label">商品名稱</div>
                                                                <div class="col-lg-2 col-md-2">商品單價</div>
                                                                <div class="col-lg-2 col-md-2">數量</div>
                                                                <div class="col-lg-2 col-md-2">小計</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>合計</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row" v-for="detail in item.orderDetails">
                                                                <div class="col-lg-3 col-md-4 label">{{detail.dishName}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.unitPrice}}</div>
                                                                <div class="col-lg-2 col-md-2">{{detail.quantity}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.subtotal}}</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>Total: ${{item.total}}</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div>
                                                        <h5>備註: </h5>
                                                        <div>{{ item.note }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tab-content pt-2" v-else>
                                            <div class="card" v-for="item in currentPageOrders" :key="item.orderId">
                                                <div class="card-body">
                                                    <h5 class="card-title">訂單編號: {{ item.orderId }} </h5>
                                                    <h5>下訂時間: {{item.orderDate}}</h5>
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row">
                                                                <div class="col-lg-3 col-md-4 label">商品名稱</div>
                                                                <div class="col-lg-2 col-md-2">商品單價</div>
                                                                <div class="col-lg-2 col-md-2">數量</div>
                                                                <div class="col-lg-2 col-md-2">小計</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>合計</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-10" style="padding-bottom:10px">
                                                            <div class="row" v-for="detail in item.orderDetails">
                                                                <div class="col-lg-3 col-md-4 label">{{detail.dishName}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.unitPrice}}</div>
                                                                <div class="col-lg-2 col-md-2">{{detail.quantity}}</div>
                                                                <div class="col-lg-2 col-md-2">${{detail.subtotal}}</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div>Total: ${{item.total}}</div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div>
                                                        <h5>備註: </h5>
                                                        <div>{{ item.note }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <div class="container">
                        <ul class="pagination justify-content-center custom-pagination">
                            <li class="page-item" :class="{ 'disabled': currentPage === 1 }"><a class="page-link" href="#" @@click="goToPage(currentPage - 1)"><</a></li>
                            <li class="page-item "
                                v-for="page in totalPages"
                                :key="page"
                                :class="{ 'active': currentPage === page }"><a class="page-link" href="#" @@click="goToPage(page)">{{page}}</a></li>
                            <li class="page-item"
                                :class="{'disabled': currentPage === totalPages}">
                                <a class="page-link" href="#" @@click="goToPage(currentPage + 1)">></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue@3.2.36/dist/vue.global.prod.js"></script>
    <script src="~/axios/axios.min.js"></script>
    <script>
        var baseAddress = "https://localhost:7163/api/UserApi";
        
        var vueApp = {
            data() {
                return {
                    CustomerOrderInfo: [],
                    searchResult: null,
                    searchorderId: "",
                    currentPage: 1, // 當前分頁
                    pageSize: 8 // 每頁顯示的商品數量
                }
            },
            mounted() {
                this.getUserOrder();
            },
            computed: {
                totalPages() {
                    // 計算總分頁數
                    return Math.ceil(this.CustomerOrderInfo.length / this.pageSize);
                },
                currentPageOrders() {
                    // 計算當前分頁的商品
                    const startIndex = (this.currentPage - 1) * this.pageSize;
                    const endIndex = startIndex + this.pageSize;
                    return this.CustomerOrderInfo.slice(startIndex, endIndex);
                }
            },
            methods: {
                async getUserOrder() {
                    //拿出對應cusId的order
                    try {
                        const response = await axios.get(`${baseAddress}/waitorder`, {
                            withCredentials: true}).then(Response => {
                            this.CustomerOrderInfo = Response.data;
                        })
                    } catch (error) {
                        console.error(error);
                    }
                },
                searchOrder(searchorderId) {
                    const foundOrder = this.CustomerOrderInfo.find(order => order.orderId === searchorderId)
                    if (foundOrder) {
                        this.searchResult = foundOrder;
                        console.log("match")
                    }
                    else {
                        this.searchResult = null;
                        console.log("notmatch")
                    }
                },
                goToPage(page) {
                    // 前往指定分頁
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                    }
                }
            }
        };
        var app = Vue.createApp(vueApp).mount("#app");
    </script>
    }


